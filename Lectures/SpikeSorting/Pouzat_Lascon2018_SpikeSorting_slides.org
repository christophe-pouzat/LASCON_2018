# -*- ispell-local-dictionary: "american" -*-
#+TITLE: Spike Sorting
#+AUTHOR: @@latex:{\large Christophe Pouzat} \\ \vspace{0.2cm}MAP5, Paris-Descartes University and CNRS\\ \vspace{0.2cm} \texttt{christophe.pouzat@parisdescartes.fr}@@
#+DATE: LASCON, January 23 2018, Lecture 3
#+OPTIONS: H:2 tags:nil
#+EXCLUDE_TAGS: noexport
#+LANGUAGE: en
#+SELECT_TAGS: export
#+LATEX_CLASS: beamer
#+LATEX_CLASS_OPTIONS: [presentation]
#+BEAMER_HEADER: \setbeamercovered{invisible}
#+BEAMER_HEADER: \AtBeginSection[]{\begin{frame}<beamer>\frametitle{Where are we ?}\tableofcontents[currentsection]\end{frame}}
#+BEAMER_HEADER: \beamertemplatenavigationsymbolsempty
#+STARTUP: beamer
#+COLUMNS: %45ITEM %10BEAMER_ENV(Env) %10BEAMER_ACT(Act) %4BEAMER_COL(Col) %8BEAMER_OPT(Opt)
#+STARTUP: indent
#+PROPERTY: header-args :eval no-export


* Ensemble recordings
** Why do we want to record from many neurons?
Neurophysiologists are trying to record many neurons at once *with single neuron resolution* because:
+ They can collect more data per experiment.
+ They have reasons to think that neuronal information processing might involve synchronization among neurons, an hypothesis dubbed *binding by synchronization* in the field.

** Ensemble recordings: multi-electrode array (MEA)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.75\textwidth
[[./imgs/BrainProbeData.png]]
#+END_CENTER
Left, the brain and the recording probe with 16 electrodes (bright spots). Width of one probe shank: 80 $\mu m$. Right, 1 sec of raw data from 4 electrodes. The local extrema are  the action potentials. The insect shown on the figure is a locust, /Schistocerca americana/. Source: Pouzat, Mazor and Laurent.

** What a /Schistocerca americana/ looks like?
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.4\textwidth
[[~/Base_Figures/Schistocerca_americana_headshot.jpg]]
#+END_CENTER
"Schistocerca americana headshot" by Rob Ireton - http://www.flickr.com/photos/24483890@N00/7182552776/. Licensed under Creative Commons.

** Voltage sensitive dyes
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Homma+:2009Fig2.jpg]]
#+END_CENTER
Fig. 2 of Homma et al (2009) /Phil Trans R Soc B/ \textbf{364}:2453.

** Ensemble recordings: voltage-sensitive dyes (VSD)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 1.0\textwidth
[[~/Base_Figures/Frost+:2010Fig5-3.png]]
#+END_CENTER
Imaging of the pedal ganglion of /Tritonia/ by Frost et al (2010), Chap. 5 of /Membrane Potential Imaging in the Nervous System/, edited by M. Canepari and D. Zevecic.

** What a /Tritonia/ looks like?
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.9\textwidth
[[~/Base_Figures/Tritonia_festiva.jpg]]
#+END_CENTER
"Tritonia festiva" by Daniel Hershman from Federal Way, US - edmonds4. Licensed under Creative Commons Attribution 2.0 via Wikimedia Commons.

** Ensemble recordings: calcium concentration imaging
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.5\textwidth
[[~/Base_Figures/Homma+:2009Fig10.jpg]]
#+END_CENTER
Embryonic mouse brainstem-spinal chord preparation. Fig. 10 of Homma et al (2010) /Phil Trans R Soc B/ \textbf{364}:2453.  

* What is spike sorting?
** Why are tetrodes used?

#+ATTR_LaTeX: :width 0.75\textwidth
[[./imgs/BrainProbeDataZoom.png]]

The last 200 ms of the locust figure. With the upper recording site only it would be difficult to properly classify the two first large
spikes (**). With the lower site only it would be difficult to properly classify the two spikes labeled by ##.

** What do we want?

+ Find the number of neurons contributing to the data.
+ Find the value of a set of parameters characterizing the signal generated by each neuron (/e.g./, the spike waveform of each neuron on each recording site).
+ Acknowledging the classification ambiguity which can arise from waveform similarity and/or signal corruption due to noise, the probability for each neuron to have generated each event (spike) in the data set.
+ A method as automatic as possible.

** A similar problem 
+ Think of a room with many people seating and talking to each other using a language we do not know.
+ Assume that microphones were placed in the room and that their recordings are given to us.
+ Our task is to isolate the discourse of each person.

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.8\textwidth
[[~/Base_Figures/OwnPapers/Brueghel_plus.png]]
#+END_CENTER
With apologies to Brueghel (original, without microphones, in Vienna, Kunsthistorisches Museum).

** 
To fulfill our task we could make use of the following features:
- Some people have a low pitch voice while other have a high
  pitch one.
- Some people speak loudly while other do not.
- One person can be close to one microphone and far from another
  such that its talk is simultaneously recorded by the two with
  different amplitudes. 
- Some people speak all the time while other just utter a
  comment here and there, that is, the discourse statistics changes
  from person to person.

** VSD does not eliminate the sorting problem (1)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.75\textwidth
[[file:~/Base_Figures/Zecevic+1989Fig1.png]]
#+END_CENTER

VSD recording from Aplysia's abdominal ganglion, Fig. 1 of Zecevic et al (1989) /J Neurosci/ \textbf{9}:3681.

** Aplysia
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.75\textwidth
[[file:~/Base_Figures/Aplysia_californica.jpg]]
#+END_CENTER

Source: Wikipedia, Licensed under Creative Commons Attribution-Share Alike 3.0 via Wikimedia Commons.

** VSD does not eliminate the sorting problem (2)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[file:~/Base_Figures/Zecevic+1989Fig2.png]]
#+END_CENTER

Fig. 2 of Zecevic et al (1989).

** Calcium signals have slow kinetics!
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.75\textwidth
[[~/Base_Figures/Canepari+:2010Fig4-3.png]]
#+END_CENTER

Fig. 4 of Canepari et al (2010), Chap. 4 of of /Membrane Potential Imaging in the Nervous System/, edited by M. Canepari and D. Zevecic.

** Spike sorting also matters for neurologists
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.75\textwidth
[[~/Base_Figures/EMG.png]]
#+END_CENTER
Neurologist perform daily electromyographic (EMG) recordings monitoring *muscle fibers* action potentials.

* What do we measure? The origin of the signal.

** What makes (most) neurons "special"?
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.6\textwidth
[[~/Base_Figures/Randall+:1997Fig5-16.png]]
#+END_CENTER

If we /depolarize/ neurons "enough", an "active response" of /action potential/ is generated. Fig. 5-16 of Randall et al (1997).

** The action potential propagates!
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.8\textwidth
[[~/Base_Figures/Antic+Fig2:2000.jpg]]
#+END_CENTER

VSD recording from the giant metacerebral neuron of /Helix aspersa/. Fig. 2 of Antic et al (2000) /J Physiol/ \textbf{527}:55. 

** The giant metacerebral neuron of /Helix aspersa/
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Antic+Fig1:2000.jpg]]
#+END_CENTER
Fig. 1 of Antic et al (2000).

** /Helix aspersa/
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Helix_aspersa.jpg]]
#+END_CENTER
"Snail1web". Licensed under Public domain via Wikimedia Commons.

** Currents associated with a non-uniform membrane potential
When the membrane potential, $V_m$, is spatially non-uniform *axial*, $I_i$ [A], and *trans-membrane*, $i_m$ [A/L], currents are necessarily present:
\[I_i = - \pi a^2 \sigma_i \partial V_m / \partial x\]
and
\[i_m = \pi a^2 \sigma_i \partial^2 V_m / \partial x^2 \, ,\]
where $a$ is the axon / neurite diameter, the neurite is assumed to "seat" on the $x$ axis, an axial current is positive if it goes in the increasing $x$ direction and a trans-mambrane current is positive if it goes from inside to outside and $\sigma_i$ is the intracellular conductance per centimeter [S/L]. See for instance Plonsey and Barr (2007) Chap. 6 and 8.

** Currents associated with a propagating AP
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Plonsey+Barr2007Fig8-3.png]]
#+END_CENTER
Fig. 8.3 of Plonsey and Barr (2007).

** Extracellular potential associated with a current source
For a point current source of intensity $I_0$ in a medium of conductivity per unit length $\sigma_e$, the extracellular potential (with respect to a reference at infinity) depends only on the distance, $r$, to the source and is given by:
\[\Phi_e = \frac{1}{4 \pi \sigma_e} \frac{I_0}{r} \, .\]
For a fiber "seating" on the $x$ axis we get at a point $(x',y',z')$ the potential:
\[\Phi_e(x',y',z') = \frac{1}{4 \pi \sigma_e} \int_L \frac{i_m(x)}{\sqrt{(x-x')^2+y'^2+z'^2}} dx \, .\]

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.6\textwidth
[[~/Base_Figures/Plonsey+Barr2007Fig8-5.png]]
#+END_CENTER
Part of Fig. 8.5 of Plonsey and Barr (2007).

Using our previous expression for $i_m$ we get:
\[\Phi_e(x',y',z') = \frac{a^2 \sigma_i}{4 \sigma_e} \int_L \frac{\partial^2 V_m(x)}{\partial x^2} \frac{dx}{\sqrt{(x-x')^2+y'^2+z'^2}} \, .\]

*Notice the dependence on the fiber cross-section*.

** Observed extracellular potential
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Fatt:1957Fig16.png]]
#+END_CENTER

Fig. 16 of Fatt (1957) /J Neurophys/ \textbf{20}:27. Recordings from Cats motoneurons.

** Computed extracellular potential
#+BEGIN_SRC sh :eval no-export :exports none
cd /home/xtof/Base_Figures
montage CajalFig8.png Holt1999Fig2-4.png Holt1999Fig2-5.png -geometry +4+4+4 Cajal-Holt.png
#+END_SRC

#+BEGIN_CENTER
#+ATTR_LaTeX: :width 1.0\textwidth
[[~/Base_Figures/Cajal-Holt.png]]
#+END_CENTER
Left, Fig. 8 of Santiago Ram√≥n y Cajal (1899), middle and right Fig. 2.4 and 2.5 of Holt PhD thesis (Caltech, 1999).

** The stretch receptor of /Homarus americanus/
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Eyzaguirre+Kuffler:1955aFig1a.png]]
#+END_CENTER
The preparation, Fig. 1 A of Eyzaguirre and Kuffler (1955a) /J Gen Phys/ \textbf{39}:87. 

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Eyzaguirre+Kuffler:1955aFig1b.png]]
#+END_CENTER

Fig. 1 B of Eyzaguirre and Kuffler (1955a).

** /Homarus americanus/
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Yellow-lobster.jpg]]
#+END_CENTER

"Yellow-lobster". Licensed under Creative Commons Attribution-Share Alike 3.0 via Wikimedia Commons.

** Mismatch between somatic and axonal AP?
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 1.0\textwidth
[[~/Base_Figures/EK1955bF13.png]]
#+END_CENTER

Fig. 13 of Eyzaguirre and Kuffler (1955b) /J Gen Phys/ \textbf{39}:121.

** This is not an invertebrate peculiarity
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.5\textwidth
[[~/Base_Figures/Sakmann+Stuart:2009Fig5.png]]
#+END_CENTER

Fig. 7 of Sakmann and Stuart (2009) in /Single-Channel Recording/, edited by B Sakmann and E Neher, Springer

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.6\textwidth
[[~/Base_Figures/Williams+Stuart:1999Fig5.jpg]]
#+END_CENTER

Fig. 5 of Williams and Stuart (1999) /J Physiol/ \textbf{521}:467.

** No more than a HH model is required
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Cooley+Dodge1966Fig5.png]]
#+END_CENTER

Fig. 5 of Cooley and Dodge (1966) /Biophys J/ \textbf{6}:583.

** A note on slice recording
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.5\textwidth
[[~/Base_Figures/Sakmann+Stuart:2009Fig1.png]]
#+END_CENTER

Fig. 1 of Sakmann and Stuart (2009)

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Aitken+:1995Fig2.png]]
#+END_CENTER

Fig. 2 of Aitken et al (1995) /J Neurosci Methods/ \textbf{59}:139.

** What happens when the diameter increases?
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Goldstein+Rall:1974Fig10.png]]
#+END_CENTER

Numerical model, Fig. 10 of Goldstein and Rall (1974) /Biophys J/ \textbf{14}:731.

** Reflected AP can happen!
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.8\textwidth
[[~/Base_Figures/Antic+Fig5:2000.jpg]]
#+END_CENTER

Fig. 5 of Antic et al (2000). 

* A short history of spike sorting

** Sorting by eye
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.5\textwidth
[[~/Base_Figures/Hartline+Graham1932Fig4.png]]
#+END_CENTER
As soon as the "the all-or-nothing response of sensory nerve fibres" was established by Adrian and Forbes (1922), neurophysiologists started doing sorting by eye using the spike amplitude as a feature. Fig. 4 of Hartline and Graham (1932) /J Cell Comp Physiol/ \textbf{1}:277. /Limulus polyphemus/ recording.

** What a /Limulus polyphemus/ looks like?
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Limulus_polyphemus.jpg]]
#+END_CENTER
"Limulus polyphemus (aq.)" by Hans Hillewaert - Own work. Licensed under Creative Commons Attribution-Share Alike 4.0 via Wikimedia Commons.

** Automatic window discriminator (1963)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.6\textwidth
[[~/Base_Figures/Poggio+Mountcastle1963Fig4.png]]
#+END_CENTER
Fig. 4 of Poggio and Mountcastle (1963) /J Neurophys/ \textbf{26}:775. /In vivo/ recordings from monkeys thalamic neurons.

** Template matching (1964)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/Gerstein+Clark1964Fig1.png]]
#+END_CENTER
Fig. 1 of Gerstein and Clark (1964) /Science/ \textbf{143}:1325. Dorsal cochlear nucleus recordings from anesthetized cats.

** Dimension reduction and cluster membership (1965)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 1.0\textwidth
[[~/Base_Figures/Simon1965Fig1-3.png]]
#+END_CENTER
Fig. 1-3 of Simon (1965) /Electroenceph clin Neurophysiol/ \textbf{18}:192. 

** Superposition resolution (1972)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.4\textwidth
[[~/Base_Figures/Prochazka+1972Fig3.png]]
#+END_CENTER
Fig. 3 of Prochazka et al (1972) /Electroenceph clin Neurophysiol/ \textbf{32}:95. 

** Multi-channel linear filter: principle
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[./imgs/PouzatFilterFig.png]]
#+END_CENTER

** 
\small
You can reconstruct the figure with the following waveforms:
+ *Neuron 1*: electrode 1 (-1,2,1,0,0,0,0,0,0) and electrode 2 (0,0,0,0,0,0,-1,2,-1).
+ *Neuron 2*: electrode 1 (-1,2,1,0,0,0,0,0,0) and electrode 2 (0,0,0,-1,2,-1,0,0,0).
And the following filters:
+ *Neuron 1*: electrode 1 (-1/2,1,1/2,0,0,0,0,0,0) and electrode 2 (0,0,0,0,0,0,-1/2,1,-1/2).
+ *Neuron 2*: electrode 1 (-1/2,1,1/2,0,0,0,0,0,0) and electrode 2 (0,0,0,-1/2,1,-1/2,0,0,0).
Given signals $E_1(t)$ and $E_2(t)$ on electrode 1 and 2, the output of filter 1 (responding to Neuron 1) is:
\footnotesize
\[F_1(t) = -E_1(t-1)/2+E_1(t)-E_1(t+1)/2-E_2(t+5)/2+E_2(t+6)-E_2(t+7)/2 \, .\]
\normalsize

** Multi-channel linear filter (1975)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.8\textwidth
[[~/Base_Figures/Roberts+Hartline1975Fig2.png]]
#+END_CENTER
Fig. 2 of Roberts and Hartline (1975) /Brain Res/ \textbf{94}:141. 

** Waveform changes during bursts (1973)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.6\textwidth
[[~/Base_Figures/Calvin1973Fig2.png]]
#+END_CENTER
Fig. 2 of Calvin (1972) /Electroenceph clin Neurophysiol/ \textbf{34}:94. 

** McNaughton, O'Keefe and Barnes solution (1983)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 1.0\textwidth
[[~/Base_Figures/McNaughton+1983Fig1b.png]]
#+END_CENTER
Part of the Introduction and Fig. 1 of McNaughton et al (1983) /J Neurosci Methods/ \textbf{8}:391.

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/McNaughton+1983Fig2and3.png]]
#+END_CENTER
Fig. 2 and 3 of McNaughton et al (1983)

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 1.0\textwidth
[[~/Base_Figures/McNaughton+1983Fig5.png]]
#+END_CENTER
Fig. 5 of McNaughton et al (1983)

** Sampling jitter (1984)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.7\textwidth
[[~/Base_Figures/McGill+Dorfman1984Fig1.png]]
#+END_CENTER
Fig. 1 of McGill and Dorfman (1984) /IEEE Trans Biomed Eng/ \textbf{31}:462. *EMG recordings*.

** Sampling jitter correction
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.65\textwidth
[[~/Base_Figures/OwnPapers/PouzatEtAl_Fig4_2002.png]]
#+END_CENTER
Fig. 4 of Pouzat et al (2002) /J Neurosci Methods/ \textbf{122}:43.

** Sophisticated visualization tools (late 80s early 90s)
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 1.0\textwidth
[[~/Base_Figures/ScatterMatrix.png]]
#+END_CENTER
A scatter plot matrix obtained with =GGobi= (www.ggobi.org).

** Automatic clustering: K-means
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.65\textwidth
[[~/Base_Figures/Hastie+2009K-means.png]]
#+END_CENTER
Hastie et al (2009) /The Elements of Statistical Learning/. Springer. p 510.

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.65\textwidth
[[~/Base_Figures/Hastie+2009Fig14-6.png]]
#+END_CENTER
Fig. 14.6 of Hastie et al (2009).

** Gaussian Mixture Model (GMM)
GMM can be viewed as "refined" and "softer" version of the K-means. Here an individual observation is assumed to arise from the following procedure, with $K$ components in the mixture:
1. Draw the mixture component $j \in \{1,\ldots,K\}$ with probabilities $\{\pi_1,\ldots,\pi_K\}$ ($\sum_{i=1}^K \pi_i = 1$).
2. Given $j$, draw the observation $Y\in \mathbb{R}^p$ from a (multivariate) Gaussian distribution with pdf:\[\phi_{\mu_j,\Sigma_j}(y) = \frac{1}{(2 \pi)^{p/2}|\Sigma_j|^{1/2}} \exp\left(-\frac{1}{2}(y-\mu_j)^T\Sigma_j^{-1}(y-\mu_j)\right)\, .\]
The $N$ observation are assumed to be drawn independently an identically. 

The pdf of $y \in \mathbb{R}^p$ can then be written as:
\[p_Y(y) = \sum_{j=1}^K \pi_j \phi_{\mu_j,\Sigma_j}(y)\, .\]

** 
GMM inference: Expectation-Maximization (1)
Let us consider a simple case in dimension 1 with two components. We have:
+ $Y_1 \sim \mathcal{N}(\mu_1,\sigma_1^2)$
+ $Y_2 \sim \mathcal{N}(\mu_2,\sigma_2^2)$
+ $Y = (1-Z) Y_1 + Z Y_2$ 
where $Z \in \{0,1\}$ with $\mathrm{Pr}(Z=1) = \pi$. The density of $Y$ is then:
\[p_Y(y) = (1-\pi) \phi_{\mu_1,\sigma_1}(y) + \pi \phi_{\mu_2,\sigma_2}(y)\]
and the (log-)likelihood, when an IID sampe of size $N$ has been observed, is:
\[l(\pi,\mu_1,\sigma_1,\mu_2,\sigma_2) = \sum_{i=1}^{N} \ln\left[(1-\pi) \phi_{\mu_1,\sigma_1}(y_i) + \pi \phi_{\mu_2,\sigma_2}(y_i)\right] \, .\]

** 
The Expectation-Maximization (EM) algorithm for GMM "augments" the data, doing "as if" the component of origin had been observed, that is as if $(Y,Z)$ instead of simply $Y$ was known. The complete log-likelihood is then:
\small
\begin{displaymath}
\begin{array}{l l l}
l_0(\pi,\mu_1,\sigma_1,\mu_2,\sigma_2) & = & \sum_{i=1}^{N} (1-z_i)\ln \phi_{\mu_1,\sigma_1}(y_i) + z_i \ln \phi_{\mu_2,\sigma_2}(y_i) +\\
& &  \sum_{i=1}^{N} (1-z_i)\ln(1-\pi) + z_i \ln(\pi) \, .
\end{array}
\end{displaymath}
\normalsize
Since the $z_i$ are not known, the EM proceeds in a iterative fashion, by substituting their expected values:
\[\gamma_i = \mathrm{E}(Z_i|\pi,\mu_1,\sigma_1,\mu_2,\sigma_2) = \mathrm{Pr}(Z_i=1|\pi,\mu_1,\sigma_1,\mu_2,\sigma_2) \, ,\]
also called the *responsibility* of the second component for observation $i$. 

** 
#+BEGIN_CENTER
#+ATTR_LaTeX: :width 0.75\textwidth
[[~/Base_Figures/Hastie+2009EM.png]]
#+END_CENTER
Hastie et al (2009) p 275.

** Automatic choice of $K$
The number of components can be automatically chosen by minimizing a penalized likelihood with  *Akaike's Information Criterion* (AIC):
\[K = \arg \min_k -2 l(\hat{\theta}_k) + 2 d(k) \, ,\]
where $\hat{\theta}_k$ stands for maximum likelihood estimator of the set of model parameters and $d(k)$ stands for the dimension (number of parameters) of the model.

Schwarz's *Bayesian Information Criterion* (BIC) tends to work better:
\[K = \arg \min_k -2 l(\hat{\theta}_k) + \ln(N) d(k) \, ,\]
where $N$ is the sample size.

See Chap. 7 of Hastie et al (2009) for more criteria and discussion.

** That's all for today!

Thank you for listening!  
